---
layout: single
title: "ğŸ“– ë„ë©”ì¸ ì£¼ë„ ê°œë°œ ì‹œì‘í•˜ê¸°: DDD í•µì‹¬ ê°œë… ì •ë¦¬ë¶€í„° êµ¬í˜„ê¹Œì§€"
categories: [etc, books]
tag: [books, DDD]
author_profile: true
toc: true
toc_sticky: true
---

[ë„ë©”ì¸ ì£¼ë„ ê°œë°œ ì‹œì‘í•˜ê¸°: DDD í•µì‹¬ ê°œë… ì •ë¦¬ë¶€í„° êµ¬í˜„ê¹Œì§€](https://product.kyobobook.co.kr/detail/S000001810495){:target="_blank"} ì±…ì„ ì½ê³  ë‚´ìš©ì„ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤. ì±…ì—ëŠ” ìì„¸í•œ ì„¤ëª…ê³¼ ì˜ˆì œê°€ ë§ìœ¼ë‹ˆ **ê¼­ êµ¬ì…í•´ì„œ ì½ëŠ”ê²ƒì„ ì¶”ì²œ**í•©ë‹ˆë‹¤~ğŸ‘

---

# 1. ë„ë©”ì¸ ëª¨ë¸ ì‹œì‘í•˜ê¸°
## 1.1 ë„ë©”ì¸ì´ë€?
ì†Œí”„íŠ¸ì›¨ì–´ë¡œ í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œ ì˜ì—­ì„ ë„ë©”ì¸ì´ë¼ í•œë‹¤.

## 1.2 ë„ë©”ì¸ ì „ë¬¸ê°€ì™€ ê°œë°œì ê°„ ì§€ì‹ê³µìœ 
"Garbage in, Garbage out" ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ê°€ë©´ ì˜ëª»ëœ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤.  

ì „ë¬¸ê°€ë‚˜ ê´€ë ¨ìê°€ ìš”êµ¬í•œ ë‚´ìš©ì´ í•­ìƒ ì˜¬ë°”ë¥¸ ê²ƒì€ ì•„ë‹ˆë‹¤. ê·¸ë˜ì„œ ê°œë°œìëŠ” ìš”êµ¬ì‚¬í•­ì„ ì´í•´í•  ë•Œ ì™œ ì´ëŸ° ê¸°ëŠ¥ì¼ ìš”êµ¬í•˜ëŠ”ì§€ ë˜ëŠ” ì‹¤ì œë¡œ ì›í•˜ëŠ”ê²Œ ë¬´ì—‡ì¸ì§€ ìƒê°í•˜ê³  ì „ë¬¸ê°€ì™€ ëŒ€í™”ë¥¼ í†µí•´ ì§„ì§œë¡œ ì›í•˜ëŠ” ê²ƒì„ ì°¾ì•„ì•¼ í•œë‹¤.

## 1.3 ë„ë©”ì¸ ëª¨ë¸
ë„ë©”ì¸ ëª¨ë¸ì€ íŠ¹ì • ë„ë©”ì¸ì„ ê°œë…ì ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì´ë‹¤. ë„ë©”ì¸ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê´€ê³„ìë“¤ì´ ë™ì¼í•œ ëª¨ìŠµìœ¼ë¡œ ë„ë©”ì¸ì„ ì´í•´í•˜ê³  ë„ë©”ì¸ ì§€ì‹ì„ ê³µìœ í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤. ë„ë©”ì¸ ëª¨ë¸ì„ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ëœë‹¤ë©´ ê°ì²´ê¸°ë°˜ í‘œí˜„ì´ë“ , í•¨ìˆ˜ í‘œí˜„ì´ë“  í‘œí˜„ ë°©ì‹ì´ ë¬´ì—‡ì¸ì§€ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.
<center><img src="/assets/images/posts/books/1/1_3_ê°ì²´ê¸°ë°˜ë„ë©”ì¸ëª¨ë¸.png" alt="ê°ì²´ê¸°ë°˜ë„ë©”ì¸ëª¨ë¸" width="70%" height="70%"></center>
<center><img src="/assets/images/posts/books/1/1_3_ìƒíƒœë‹¤ì´ì–´ê·¸ë¨ë„ë©”ì¸ëª¨ë¸.png" alt="ìƒíƒœë‹¤ì´ì–´ê·¸ë¨ë„ë©”ì¸ëª¨ë¸" width="70%" height="70%"></center>

## 1.4 ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´
<center><img src="/assets/images/posts/books/1/1_4_ì•„í‚¤í…ì²˜êµ¬ì„±.png" alt="ì•„í‚¤í…ì²˜êµ¬ì„±" width="50%" height="50%"></center>

| ì˜ì—­                                          | ì„¤ëª…                                                                                                                                |
| --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤(UI) ë˜ëŠ” í‘œí˜„(Presentation) | ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì •ë³´ë¥¼ ë³´ì—¬ì¤€ë‹¤. ì—¬ê¸°ì„œ ì‚¬ìš©ìëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒë¿ë§Œ ì•„ë‹ˆë¼ ì™¸ë¶€ ì‹œìŠ¤í…œì¼ ìˆ˜ë„ ìˆë‹¤. |
| ì‘ìš©(Application)                             | ì‚¬ìš©ìê°€ ìš”ì²­í•œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•œë‹¤. ì—…ë¬´ ë¡œì§ì„ ì§ì ‘ êµ¬í˜„í•˜ì§€ ì•Šìœ¼ë©° ë„ë©”ì¸ ê³„ì¸µì„ ì¡°í•©í•´ì„œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•œë‹¤.                           |
| ë„ë©”ì¸(Domain)                                | ì‹œìŠ¤í…œì´ ì œê³µí•  ë„ë©”ì¸ ê·œì¹™ì„ êµ¬í˜„í•œë‹¤.                                                                                             |
| ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜(Infrastructure)                | ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë©”ì‹œì§• ì‹œìŠ¤í…œê³¼ ê°™ì€ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ì—°ë™ì„ ì²˜ë¦¬í•œë‹¤.                                                                |

<br/>

**ê°œë… ëª¨ë¸ê³¼ êµ¬í˜„ ëª¨ë¸**  
ê°œë… ëª¨ë¸ì€ ìˆœìˆ˜í•˜ê²Œ ë¬¸ì œë¥¼ ë¶„ì„í•œ ê²°ê³¼ë¬¼ì´ë‹¤. ê°œë… ëª¨ë¸ì€ ë°ì´í„°ë² ì´ìŠ¤, íŠ¸ëœì­ì…˜ ì²˜ë¦¬, ì„±ëŠ¥, êµ¬í˜„ ê¸°ìˆ ê³¼ ê°™ì€ ê²ƒì„ ê³ ë ¤í•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤ì œ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ê°œë… ëª¨ë¸ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ ê°œë… ëª¨ë¸ì„ êµ¬í˜„ ê°€ëŠ¥í•œ í˜•íƒœì˜ ëª¨ë¸ë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ê²Œ ëœë‹¤.

ì²˜ìŒë¶€í„° ì™„ë²½í•œ ê°œë… ëª¨ë¸ì„ ë§Œë“¤ê¸°ë³´ë‹¤ëŠ” ì „ë°˜ì ì¸ ê°œìš”ë¥¼ ì•Œ ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ê°œë… ëª¨ë¸ì„ ì‘ì„±í•´ì•¼í•œë‹¤. í”„ë¡œì íŠ¸ ì´ˆê¸°ì—ëŠ” ê°œìš” ìˆ˜ì¤€ì˜ ê°œë… ëª¨ë¸ë¡œ ë„ë©”ì¸ì— ëŒ€í•œ ì „ì²´ ìœ¤ê³½ì„ ì´í•´í•˜ëŠ” ë° ì§‘ì¤‘í•˜ê³ , êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ ê°œë… ëª¨ë¸ì„ êµ¬í˜„ ëª¨ë¸ë¡œ ì ì§„ì ìœ¼ë¡œ ë°œì „ì‹œì¼œ ë‚˜ê°€ì•¼ í•œë‹¤.


## 1.5 ë„ë©”ì¸ ëª¨ë¸ ë„ì¶œ
ë„ë©”ì¸ì„ ëª¨ë¸ë§í•  ë•Œ ê¸°ë³¸ì´ ë˜ëŠ” ì‘ì—…ì€ ëª¨ë¸ì„ êµ¬ì„±í•˜ëŠ” í•µì‹¬ êµ¬ì„±ìš”ì†Œ, ê·œì¹™, ê¸°ëŠ¥ì„ ì°¾ëŠ” ê²ƒì´ë‹¤. ì´ ê³¼ì •ì€ ìš”êµ¬ì‚¬í•­ì—ì„œ ì¶œë°œí•œë‹¤. ìš”êµ¬ì‚¬í•­ì„ í†µí•´ ë„ë©”ì¸ ëª¨ë¸ì„ ì ì§„ì ìœ¼ë¡œ ë§Œë“¤ì–´ ë‚˜ê°„ë‹¤. ì´ë ‡ê²Œ ë§Œë“  ëª¨ë¸ì€ ìš”êµ¬ì‚¬í•­ ì •ë ¨ì„ ìœ„í•´ ë„ë©”ì¸ ì „ë¬¸ê°€ë‚˜ ë‹¤ë¥¸ ê°œë°œìì™€ ë…¼ì˜í•˜ëŠ” ê³¼ì •ì—ì„œ ê³µìœ ë˜ê¸°ë„ í•œë‹¤. ëª¨ë¸ì„ ê³µìœ í•  ë•ŒëŠ” í™”ì´íŠ¸ë³´ë“œë‚˜ ìœ„í‚¤ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì„œ ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ë©´ ì¢‹ë‹¤.


## 1.6 ì—”í‹°í‹°ì™€ ë²¨ë¥˜
### 1.6.1 ì—”í‹°í‹°
- ì‹ë³„ìë¥¼ ê°€ì§„ë‹¤.
- ì‹ë³„ìëŠ” ì—”í‹°í‹° ê°ì²´ë§ˆë‹¤ ê³ ìœ í•˜ë‹¤.

### 1.6.2 ì—”í‹°í‹°ì˜ ì‹ë³„ì ìƒì„±
- íŠ¹ì • ê·œì¹™ì— ë”°ë¼ ìƒì„±.
- UUIDë‚˜ Nano IDì™€ ê°™ì€ ê³ ìœ  ì‹ë³„ì ìƒì„±ê¸° ì‚¬ìš©.
- ê°’ì„ ì§ì ‘ ì…ë ¥.
- ì¼ë ¨ë²ˆí˜¸ ì‚¬ìš©(ì‹œí€€ìŠ¤ë‚˜ DBì˜ ìë™ ì¦ê°€ ì»¬ëŸ¼ ì‚¬ìš©).

### 1.6.3 ë°¸ë¥˜ íƒ€ì…
- ë°¸ë¥˜ íƒ€ì…ì€ ê°œë…ì ìœ¼ë¡œ ì™„ì „í•œ í•˜ë‚˜ë¥¼ í‘œí˜„í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- ì˜ë¯¸ë¥¼ ëª…í™•í•˜ê²Œ í‘œí˜„í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ê¸°ë„ í•œë‹¤.
- ë°¸ë¥˜ íƒ€ì…ì„ ìœ„í•œ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
- ë¶ˆë³€ìœ¼ë¡œ êµ¬í˜„í•œë‹¤.

### 1.6.4 ì—”í‹°í‹° ì‹ë³„ìì™€ ë°¸ë¥˜ íƒ€ì…
- ì‹ë³„ìë¥¼ ìœ„í•œ ë°¸ë¥˜ íƒ€ì…ì„ ì‚¬ìš©í•´ì„œ ì˜ë¯¸ê°€ ì˜ ë“œëŸ¬ë‚˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

### 1.6.5 ë„ë©”ì¸ ëª¨ë¸ì— set ë„£ì§€ ì•Šê¸°
- ìƒíƒœ ë³€ê²½ì„ ìœ„í•œ set ì‚¬ìš©ì‹œ ë„ë©”ì¸ ì§€ì‹ì´ ì½”ë“œì—ì„œ ì‚¬ë¼ì§„ë‹¤.
- ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ì˜¨ì „í•˜ì§€ ì•Šì€ ìƒíƒœê°€ ë  ìˆ˜ ìˆë‹¤. 

**DTOë„ ìµœëŒ€í•œ ë¶ˆë³€ ê°ì²´ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•˜ì**

## 1.7 ë„ë©”ì¸ ìš©ì–´ì™€ ìœ ë¹„ì¿¼í„°ìŠ¤ ì–¸ì–´
**ë„ë©”ì¸ ìš©ì–´**  
STEP1, STEP2 ê°™ì€ê²ƒì´ ì•„ë‹Œ PAYMENT_WAITING, PREPARING ê°™ì€ ë„ë©”ì¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

**ìœ ë¹„ì¿¼í„°ìŠ¤ ì–¸ì–´**  
ì „ë¬¸ê°€, ê´€ê³„ì ê°œë°œìê°€ ë„ë©”ì¸ê³¼ ê´€ë ¨ëœ ê³µí†µì˜ ì–¸ì–´ë¥¼ ë§Œë“¤ê³  ì´ë¥¼ ëŒ€í™”, ë¬¸ì„œ, ë„ë©”ì¸ ëª¨ë¸, ì½”ë“œ í…ŒìŠ¤íŠ¸ ë“± ëª¨ë“  ê³³ì—ì„œ ê°™ì€ ìš©ì–´ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì†Œí†µ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ìš©ì–´ì˜ ëª¨í˜¸í•¨ì„ ì¤„ì¼ ìˆ˜ ìˆê³  ê°œë°œìëŠ” ë„ë©”ì¸ê³¼ ì½”ë“œ ì‚¬ì´ì—ì„œ ë¶ˆí•„ìš”í•œ í•´ì„ ê³¼ì •ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

<br/>

# 2. ì•„í‚¤íƒì²˜ ê°œìš”
## 2.1 ë„¤ ê°œì˜ ì˜ì—­
**í‘œí˜„ ì˜ì—­**  
ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ì•„ ì‘ìš© ì˜ì—­ì— ì „ë‹¬í•˜ê³  ì‘ìš© ì˜ì—­ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë‹¤ì‹œ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ëŠ” ì—­í• 
<center><img src="/assets/images/posts/books/1/2_1_í‘œí˜„ì˜ì—­.png" alt="í‘œí˜„ì˜ì—­" width="80%" height="80%"></center>

<br/>

**ì‘ìš© ì˜ì—­**  
í‘œí˜„ ì˜ì—­ì„ í†µí•´ ìš”ì²­ì„ ì „ë‹¬ë°›ì•„ ì‹œìŠ¤í…œì´ ì‚¬ìš©ìì—ê²Œ ì œê³µí•´ì•¼ í•  ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ì—­í• . ë¡œì§ì„ ì§ì ‘ ìˆ˜í–‰í•˜ê¸°ë³´ë‹¤ëŠ” ë„ë©”ì¸ ëª¨ë¸ì— ë¡œì§ ìˆ˜í–‰ì„ ìœ„ì„í•œë‹¤.
<center><img src="/assets/images/posts/books/1/2_1_ì‘ìš©ì˜ì—­.png" alt="ì‘ìš©ì˜ì—­" width="80%" height="80%"></center>

<br/>

**ë„ë©”ì¸ ì˜ì—­**  
ë„ë©”ì¸ ëª¨ë¸ì„ êµ¬í˜„. ë„ë©”ì¸ ëª¨ë¸ì€ ë„ë©”ì¸ì˜ í•µì‹¬ ë¡œì§ì„ êµ¬í˜„í•œë‹¤.

<br/>

**ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ì˜ì—­**  
êµ¬í˜„ ê¸°ìˆ ì— ëŒ€í•œ ê²ƒì„ ë‹¤ë£¬ë‹¤. ì´ ì˜ì—­ì€ ë…¼ë¦¬ì ì¸ ê°œë…ì„ í‘œí˜„í•˜ê¸°ë³´ë‹¤ëŠ” ì‹¤ì œ êµ¬í˜„ì„ ë‹¤ë£¬ë‹¤.
<center><img src="/assets/images/posts/books/1/2_1_ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ì˜ì—­.png" alt="ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ì˜ì—­" width="40%" height="40%"></center>


## 2.2 ê³„ì¸µ êµ¬ì¡° ì•„í‚¤í…ì²˜
<img src="/assets/images/posts/books/1/2_2_ê³„ì¸µêµ¬ì¡°.png" alt="ê³„ì¸µêµ¬ì¡°" width="30%" height="30%">
<img src="/assets/images/posts/books/1/2_2_ê³„ì¸µêµ¬ì¡°ìƒì˜ì¡´ê´€ê³„.png" alt="ê³„ì¸µêµ¬ì¡°ìƒì˜ì¡´ê´€ê³„" width="50%" height="50%">
- ìƒìœ„ ê³„ì¸µì—ì„œ í•˜ìœ„ ê³„ì¸µìœ¼ë¡œ ì˜ì¡´ë§Œ ì¡´ì¬í•˜ê³  í•˜ìœ„ ê³„ì¸µì—ì„œ ìƒìœ„ ê³„ì¸µì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.

## 2.3 DIP
<center><img src="/assets/images/posts/books/1/2_3_ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€.png" alt="ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€" width="60%" height="60%"></center>
<center><img src="/assets/images/posts/books/1/2_3_ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€2.png" alt="ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€2" width="60%" height="60%"></center>
<center><img src="/assets/images/posts/books/1/2_3_ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€3.png" alt="ê³ ìˆ˜ì¤€ì €ìˆ˜ì¤€3" width="60%" height="60%"></center>
<center><img src="/assets/images/posts/books/1/2_3_DIP.png" alt="DIP" width="70%" height="70%"></center>

## 2.4 ë„ë©”ì¸ ì˜ì—­ì˜ ì£¼ìš” êµ¬ì„±ìš”ì†Œ

| **ìš”ì†Œ** | **ì„¤ëª…** |
| ------  | ------- |
| ì—”í‹°í‹° ENTITY                | ê³ ìœ ì˜ ì‹ë³„ìë¥¼ ê°–ëŠ” ê°ì²´ë¡œ ìì‹ ì˜ ë¼ì´í”„ ì‚¬ì´í´ì„ ê°–ëŠ”ë‹¤. ì£¼ë¬¸, íšŒì›, ìƒí’ˆê³¼ ê°™ì´ ë„ë©”ì¸ì˜ ê³ ìœ í•œ ê°œë…ì„ í‘œí˜„í•œë‹¤. ë„ë©”ì¸ ëª¨ë¸ì˜ ë°ì´í„°ë¥¼ í¬í•¨í•˜ë©° í•´ë‹¹ ë°ì´í„°ì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ í•¨ê»˜ ì œê³µí•œë‹¤. |
| ë°¸ë¥˜ VALUE                   | ê³ ìœ ì˜ ì‹ë³„ìë¥¼ ê°–ì§€ ì•ŠëŠ” ê°ì²´ë¡œ ì£¼ë¡œ ê°œë…ì ìœ¼ë¡œ í•˜ë‚˜ì¸ ê°’ì„ í‘œí˜„í•œë‹¤. ì—”í‹°í‹°ì˜ ì†ì„±ìœ¼ë¡œ ì‚¬ìš©í•  ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ë°¸ë¥˜ íƒ€ì…ì˜ ì†ì„±ìœ¼ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.                                        |
| ì• ê·¸ë¦¬ê±°íŠ¸ AGGREGATE         | ì—°ê´€ëœ ì—”í‹°í‹°ì™€ ë°¸ë¥˜ ê°ì²´ë¥¼ ê°œë…ì ìœ¼ë¡œ í•˜ë‚˜ë¡œ ë¬¶ì€ ê²ƒì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì£¼ë¬¸ê³¼ ê´€ë ¨ëœ Order ì—”í‹°í‹°, OrderLine ë°¸ë¥˜, Orderer ë°¸ë¥˜ ê°ì²´ë¥¼ 'ì£¼ë¬¸' ì• ê·¸ë¦¬ê±°íŠ¸ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤.                         |
| ë¦¬í¬ì§€í„°ë¦¬ REPOSITORY        | ë„ë©”ì¸ ëª¨ë¸ì˜ ì˜ì†ì„±ì„ ì²˜ë¦¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ DBMS í…Œì´ë¸”ì—ì„œ ì—”í‹°í‹° ê°ì²´ë¥¼ ë¡œë”©í•˜ê±°ë‚˜ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.                                                                                  |
| ë„ë©”ì¸ ì„œë¹„ìŠ¤ DOMAIN SERVICE | íŠ¹ì • ì—”í‹°í‹°ì— ì†í•˜ì§€ ì•Šì€ ë„ë©”ì¸ ë¡œì§ì„ ì œê³µí•œë‹¤. ë„ë©”ì¸ ë¡œì§ì´ ì—¬ëŸ¬ ì—”í‹°í‹°ì™€ ë°¸ë¥˜ë¥¼ í•„ìš”ë¡œ í•˜ë©´ ë„ë©”ì¸ ì„œë¹„ìŠ¤ì—ì„œ ë¡œì§ì„ êµ¬í˜„í•œë‹¤.                                                            |


## 2.5 ìš”ì²­ ì²˜ë¦¬ íë¦„
<center><img src="/assets/images/posts/books/1/2_5_ìš”ì²­ì²˜ë¦¬íë¦„.png" alt="ìš”ì²­ì²˜ë¦¬íë¦„" width="80%" height="80%"></center>

## 2.6 ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê°œìš”
- ë„ë©”ì¸ ê°ì²´ì˜ ì˜ì†ì„± ì²˜ë¦¬, íŠ¸ëœì ì…˜, REST í´ë¼ì´ì–¸íŠ¸ ë“± ë‹¤ë¥¸ì˜ì—­ì—ì„œ í•„ìš”ë¡œ í•˜ëŠ” í”„ë ˆì„ì›Œí¬, êµ¬í˜„ ê¸°ìˆ , ë³´ì¡° ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.
- ë³´í†µ ì˜ì¡´ì„±ì—­ì „ ì‚¬ìš©
- @Transactional ê°™ì€ DIPë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì˜ˆì™¸ë„ í¸ì˜ë¥¼ ìœ„í•´ í—ˆìš©

## 2.7 ëª¨ë“ˆ êµ¬ì„±
<center><img src="/assets/images/posts/books/1/2_7_ëª¨ë“ˆêµ¬ì„±1.png" alt="ëª¨ë“ˆêµ¬ì„±1" width="60%" height="60%"></center>
<center><img src="/assets/images/posts/books/1/2_7_ëª¨ë“ˆêµ¬ì„±2.png" alt="ëª¨ë“ˆêµ¬ì„±2" width="60%" height="60%"></center>
<center><img src="/assets/images/posts/books/1/2_7_ëª¨ë“ˆêµ¬ì„±3.png" alt="ëª¨ë“ˆêµ¬ì„±3" width="60%" height="60%"></center>


# 3. ì• ê·¸ë¦¬ê±°íŠ¸
## 3.1 ì• ê·¸ë¦¬ê±°íŠ¸
ë³µì¡í•œ ë„ë©”ì¸ì„ ì´í•´í•˜ê³  ê´€ë¦¬í•˜ê¸° ì‰¬ìš´ ë‹¨ìœ„ë¡œ ë§Œë“œë ¤ë©´ ìƒìœ„ ìˆ˜ì¤€ì—ì„œ ëª¨ë¸ì„ ì¡°ë§í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ í•„ìš”í•œë°, ê·¸ ë°©ë²•ì´ ë°”ë¡œ ì• ê·¸ë¦¬ê±°íŠ¸ë‹¤. ì• ê·¸ë¦¬ê±°íŠ¸ëŠ” ê´€ë ¨ëœ ê°ì²´ë¥¼ í•˜ë‚˜ì˜ êµ°ìœ¼ë¡œ ë¬¶ì–´ ì¤€ë‹¤.
<center><img src="/assets/images/posts/books/1/3_1_ì• ê±°ë¦¬ê±°íŠ¸ëª¨ë¸.png" alt="ì• ê±°ë¦¬ê±°íŠ¸ëª¨ë¸" width="60%" height="60%"></center>

ì• ê·¸ë¦¬ê±°íŠ¸ëŠ” ê²½ê³„ë¥¼ ê°–ëŠ”ë‹¤. í•œ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ê°ì²´ëŠ” ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•˜ì§€ ì•ŠëŠ”ë‹¤. ì• ê·¸ë¦¬ê±°íŠ¸ëŠ” ë…ë¦½ëœ ê°ì²´ êµ°ì´ë©° ê° ì• ê·¸ë¦¬ê±°íŠ¸ëŠ” ìê¸° ìì‹ ì„ ê´€ë¦¬í•  ë¿ ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ê²½ê³„ë¥¼ ì„¤ì •í•  ë•Œ ê¸°ë³¸ì´ ë˜ëŠ” ê²ƒì€ ë„ë©”ì¸ ê·œì¹™ê³¼ ìš”êµ¬ì‚¬í•­ì´ë‹¤. ë„ë©”ì¸ ê·œì¹™ì— ë”°ë¼ í•¨ê»˜ ìƒì„±ë˜ëŠ” êµ¬ì„±ìš”ì†ŒëŠ” í•œ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.

## 3.2 ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸
ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ëª¨ë“  ê°ì²´ê°€ ì¼ê´€ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ë©´ ì• ê·¸ë¦¬ê±°íŠ¸ ì „ì²´ë¥¼ ê´€ë¦¬í•  ì£¼ì²´ê°€ í•„ìš”í•œë°, ì´ ì±…ì„ì„ ì§€ëŠ” ê²ƒì´ ë°”ë¡œ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ ì—”í‹°í‹°ì´ë‹¤. ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ê°ì²´ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ ì—”í‹°í‹°ì— ì§ì ‘ ë˜ëŠ” ê°„ì ‘ì ìœ¼ë¡œ ì†í•˜ê²Œ ëœë‹¤.
<center><img src="/assets/images/posts/books/1/3_2_ì• ê·¸ë¦¬ê±°íŠ¸ë£¨íŠ¸.png" alt="ì• ê·¸ë¦¬ê±°íŠ¸ë£¨íŠ¸" width="50%" height="50%"></center>

### 3.2.1 ë„ë©”ì¸ ê·œì¹™ê³¼ ì¼ê´€ì„±
- ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ì˜ í•µì‹¬ ì—­í• ì€ ì• ê·¸ë¦¬ê±°íŠ¸ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ ìœ„í•´ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ê°€ ì œê³µí•´ì•¼ í•  ë„ë©”ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.
- ì• ê·¸ë¦¬ê±°íŠ¸ ì™¸ë¶€ì—ì„œ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´ ì•ˆëœë‹¤. ì´ê²ƒì€ ëª¨ë¸ì˜ ì¼ê´€ì„±ì„ ê¹¨ëŠ” ì›ì¸ì´ ëœë‹¤.
- ë‹¨ìˆœíˆ í•„ë“œë¥¼ ë³€ê²½í•˜ëŠ” set ë©”ì„œë“œë¥¼ ê³µê°œ(public) ë²”ìœ„ë¡œ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.
- ë°¸ë¥˜ íƒ€ì…ì€ ë¶ˆë³€ìœ¼ë¡œ êµ¬í˜„í•œë‹¤.

### 3.2.2 ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ì˜ ê¸°ëŠ¥ êµ¬í˜„
- ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë‚´ë¶€ì˜ ë‹¤ë¥¸ ê°ì²´ë¥¼ ì¡°í•©í•´ ê¸°ëŠ¥ì„ ì™„ì„±í•œë‹¤.
- ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ê°€ êµ¬ì„±ìš”ì†Œì˜ ìƒíƒœë§Œ ì°¸ì¡°í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ê¸°ëŠ¥ ì‹¤í–‰ì„ ìœ„ì„í•˜ê¸°ë„ í•œë‹¤.

### 3.2.3 íŠ¸ëœì ì…˜ ë²”ìœ„
- ì‘ì„ìˆ˜ë¡ ì¢‹ë‹¤
- í•œ íŠ¸ëœì ì…˜ì—ì„œëŠ” í•œ ê°œì˜ ì• ê·¸ë¦¬ê±°íŠ¸ë§Œ ìˆ˜ì •í•œë‹¤.
- ë¶€ë“ì´í•˜ê²Œ í•œ íŠ¸ëœì ì…˜ìœ¼ë¡œ ë‘ ê°œ ì´ìƒì˜ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤ë©´ ì• ê·¸ë¦¬ê±°íŠ¸ì—ì„œ ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìˆ˜ì •í•˜ì§€ ë§ê³ , ì‘ìš© ì„œë¹„ìŠ¤ì—ì„œ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìˆ˜ì •í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.
- ë‘ ê°œ ì´ìƒì˜ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤ë©´, ë„ë©”ì¸ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.

## 3.3 ë¦¬í¬ì§€í„°ë¦¬ì™€ ì• ê·¸ë¦¬ê±°íŠ¸
- ì• ê·¸ë¦¬ê±°íŠ¸: ê°œë…ìƒ ì™„ì „í•œ í•˜ë‚˜ì˜ ë„ë©”ì¸ ëª¨ë¸
- ë¦¬í¬ì§€í„°ë¦¬: ì• ê·¸ë¦¬ê±°íŠ¸ ì˜ì†ì„±ì„ ì²˜ë¦¬
  - save: ì• ê·¸ë¦¬ê±°íŠ¸ ì €ì¥
  - findById: IDë¡œ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ êµ¬í•¨

## 3.4 IDë¥¼ ì´ìš©í•œ ì• ê·¸ë¦¬ê±°íŠ¸ ì°¸ì¡°
- ì• ê·¸ë¦¬ê±°íŠ¸ë„ ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì°¸ì¡°í•œë‹¤.
- ì• ê·¸ë¦¬ê±°íŠ¸ ì°¸ì¡°ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ê°€ ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ë¥¼ ì°¸ì¡°í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

<br/>

**í•„ë“œ ì°¸ì¡°**
<center><img src="/assets/images/posts/books/1/3_4_í•„ë“œì°¸ì¡°.png" alt="í•„ë“œì°¸ì¡°" width="70%" height="70%"></center>

ë¬¸ì œì   
- í¸í•œ íƒìƒ‰ ì˜¤ìš©
- ê²°í•©ë„ ì¦ê°€
- ì„±ëŠ¥ì— ëŒ€í•œ ê³ ë¯¼
- í™•ì¥ ì–´ë ¤ì›€

<br/>

**IDë¥¼ ì´ìš©í•œ ì°¸ì¡°**
<center><img src="/assets/images/posts/books/1/3_4_IDì°¸ì¡°.png" alt="IDì°¸ì¡°" width="70%" height="70%"></center>

ì¥ì 
- ëª¨ë¸ì˜ ë³µì¡ë„ë¥¼ ë‚®ì¶˜ë‹¤
- ì‘ì§‘ë„ ì¦ê°€
- êµ¬í˜„ ë‚œì´ë„ ê°ì†Œ
- í™•ì¥ ìš©ì´


### 3.4.1 IDë¥¼ ì´ìš©í•œ ì°¸ì¡°ì™€ ì¡°íšŒ ì„±ëŠ¥
**N + 1 ë¬¸ì œ ë°œìƒ**  

í•´ê²°ë°©ë²•
- ì¡°íšŒ ì „ìš© ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•œë‹¤.
- ì¿¼ë¦¬ê°€ ë³µì¡í•˜ê±°ë‚˜ íŠ¹í™”ëœ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ë§ˆì´ë°”í‹°ìŠ¤ì™€ ê°™ì€ ê¸°ìˆ ë¡œ êµ¬í˜„í•˜ëŠ”ê±¸ ê³ ë ¤í•œë‹¤. 

## 3.5 ì• ê·¸ë¦¬ê±°íŠ¸ ê°„ ì§‘í•© ì—°ê´€
1-N, M-N ì—°ê´€ì— ëŒ€í•´ ì‚´í´ë³¸ë‹¤.

**1-N**
```java
public class Category {
    private Set<Product> products; //ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ì— ëŒ€í•œ 1-N ì—°ê´€
}
```
ì¡°íšŒì‹œ ê°œë…ì ìœ¼ë¡œ ì• ê±°ë¦¬ê±°íŠ¸ ê°„ì— 1-N ì—°ê´€ì´ ìˆë”ë¼ë„ ì„±ëŠ¥ ë¬¸ì œ ë•Œë¬¸ì— ì‹¤ì œ êµ¬í˜„ì— ë°˜ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤. N-1ë¡œ ì—°ê´€ì§€ì–´ êµ¬í˜„í•œë‹¤.

```java
public class Product {
    private CategoryId categoryId;
}
```
```java
public class ProductListService {
    public Page<Product> getProductOfCategory(Long categoryId, int page, int size) {
        Category category = categoryRepository.findById(categoryId);
        checkCategory(category);
        List<Product> products = productRepository.findByCategoryId(category.getId(), page, size);
        int totalCount = productRepository.countByCategoryId(category.getId());
        return new Page(page, size, totalCount, products);
    }
}
```

<br/>

**M-N**  
M-N ì—°ê´€ì€ ê°œë…ì ìœ¼ë¡œ ì–‘ìª½ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì»¬ë ‰ì…˜ìœ¼ë¡œ ì—°ê´€ì„ ë§Œë“ ë‹¤. í•˜ì§€ë§Œ êµ¬í˜„ì€ ìš”êµ¬ì‚¬í•­ì„ ê³ ë ¤í•´ì„œ ê²°ì •í•œë‹¤. ê°œë…ì ìœ¼ë¡œëŠ” ìƒí’ˆê³¼ ì¹´í…Œê³ ë¦¬ì˜ ì–‘ë°©í–¥ M-N ì—°ê´€ì´ ì¡´ì¬í•˜ì§€ë§Œ ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìƒí’ˆì—ì„œ ì¹´í…Œê³ ë¦¬ë¡œì˜ ë‹¨ë°©í–¥ M-N ì—°ê´€ë§Œ ì ìš©í•˜ë©´ ë˜ëŠ” ê²ƒì´ë‹¤.
```java
public class Product {
    private Set<CategoryId> categoryIds;
}
```

**RDBMSì—ì„œ M-N ì—°ê´€ êµ¬í˜„**  
<center><img src="/assets/images/posts/books/1/3_5_RDBMS_M-Nì—°ê´€.png" alt="RDBMS_M-Nì—°ê´€" width="70%" height="70%"></center>

<br/>

**JPAë¥¼ ì´ìš©í•˜ì—¬ ID ì°¸ì¡°ë¥¼ ì´ìš©í•œ M-N ë‹¨ë°©í–¥ ì—°ê´€ êµ¬í˜„**  
```java
@Entity
@Table(name = "product")
public class Product {
    @EmbeddedId
    private ProductId id;
    
    @ElementCollection
    @CollectionTable(name = "product_category",
        joinColumns = @JoinColumn(name = "product_id"))
    private Set<CategoryId> categoryIds;
    ...
}
```

## 3.6 ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ íŒ©í† ë¦¬ë¡œ ì‚¬ìš©í•˜ê¸°
- ì• ê·¸ë¦¬ê±°íŠ¸ê°€ ê°–ê³  ìˆëŠ” ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ ë‹¤ë¥¸ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤ë©´ ì• ê·¸ë¦¬ê±°íŠ¸ì— íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•œë‹¤.
- ë³„ë„ì˜ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë‚˜, íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.

```java
public class Store {

    public Product createProduct (ProductId newProductId, ...ìƒëµ) {
        if (isBlocked()) {
            throw new StoreBlockedException();
        }
        return new Product(newProductId, getId(), ...ìƒëµ);
    }

}
```

<br/>

# 4. ë¦¬í¬ì§€í„°ë¦¬ì™€ ëª¨ë¸ êµ¬í˜„
4ì¥ê³¼ 5ì¥ì€ ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ì‚¬ìš©ë°©ë²•ì— ëŒ€í•´ì„œ ì„¤ëª…í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì±…ì˜ ìì„¸í•œ ì„¤ëª…ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ë¬¸ì„œì™€ ì±…ì„ ì½ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ğŸ‘
- [ë„ë©”ì¸ ì£¼ë„ ê°œë°œ ì‹œì‘í•˜ê¸°: DDD í•µì‹¬ ê°œë… ì •ë¦¬ë¶€í„° êµ¬í˜„ê¹Œì§€](https://product.kyobobook.co.kr/detail/S000001810495){:target="_blank"}
- [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°](http://www.yes24.com/Product/Goods/19040233){:target="_blank"}
- [Spring Data JPA](https://spring.io/projects/spring-data-jpa){:target="_blank"}


## 4.1 JPAë¥¼ ì´ìš©í•œ ë¦¬í¬ì§€í„°ë¦¬ êµ¬í˜„
### 4.1.1 ëª¨ë“ˆ ìœ„ì¹˜
<center><img src="/assets/images/posts/books/1/4_1_ëª¨ë“ˆìœ„ì¹˜.png" alt="ëª¨ë“ˆìœ„ì¹˜" width="70%" height="70%"></center>

### 4.1.2 ë¦¬í¬ì§€í„°ë¦¬ ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„
```java
public interface OrderRepository {
    Order findById(OrderNo no);
    void save(Order order);
}
```
```java
public class JpaOrderRepository implements OrderRepository {
    @PersistenceContext
    private EntityManager entityManager;

    @Override
    public Order findById(OrderNo id) {
        return entityManager.find(Order.class, id);
    }

    @Override
    public void save(Order order) {
        entityManager.persist(order);
    }
}
```


## 4.2 ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì´ìš©í•œ ë¦¬í¬ì§€í„°ë¦¬ êµ¬í˜„

```java
@Entity
@Table(name = "purchase_order")
@Access(AccessType.FIELD)
public class Order {
    @EmbeddedId
    private OrderNo number;

    @Version
    private long version;

    @Embedded
    private Orderer orderer;

    ...ìƒëµ...
}
```
```java
public interface OrderRepository extends Repository<Order, OrderNo> {
    Optional<Order> findById(OrderNo id);

    void save(Order order);

    default OrderNo nextOrderNo() {
        int randomNo = ThreadLocalRandom.current().nextInt(900000) + 100000;
        String number = String.format("%tY%<tm%<td%<tH-%d", new Date(), randomNo);
        return new OrderNo(number);
    }
}
```
```java
@Service
public class CancelOrderService {
    private OrderRepository orderRepository;
    private CancelPolicy cancelPolicy;

    public CancelOrderService(OrderRepository orderRepository, CancelPolicy cancelPolicy) {
        this.orderRepository = orderRepository;
        this.cancelPolicy = cancelPolicy;
    }

    @Transactional
    public void cancel(OrderNo orderNo, Canceller canceller) {
        Order order = orderRepository.findById(orderNo)
                .orElseThrow(() -> new NoOrderException());
        if (!cancelPolicy.hasCancellationPermission(order, canceller)) {
            throw new NoCancellablePermission();
        }
        order.cancel();
    }
}
```




## 4.3 ë§¤í•‘ êµ¬í˜„
### 4.3.1 ì—”í‹°í‹°ì™€ ë°¸ë¥˜ ê¸°ë³¸ ë§¤í•‘ êµ¬í˜„
ì• ê·¸ë¦¬ê±°íŠ¸ì™€ JPA ë§¤í•‘ì„ ìœ„í•œ ê¸°ë³¸ ê·œì¹™
- ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ëŠ” ì—”í‹°í‹°ì´ë¯€ë¡œ `@Entity`ë¡œ ë§¤í•‘ ì„¤ì •í•œë‹¤.

í•œ í…Œì´ë¸”ì— ì—”í‹°í‹°ì™€ ë°¸ë¥˜ ë°ì´í„°ê°€ ê°™ì´ ìˆë‹¤ë©´
- ë°¸ë¥˜ëŠ” `@Embeddable`ë¡œ ë§¤í•‘ ì„¤ì •í•œë‹¤.
- ë°¸ë¥˜ íƒ€ì… í”„ë¡œí¼í‹°ëŠ” `@Embedded`ë¡œ ë§¤í•‘ ì„¤ì •í•œë‹¤.
- ë§¤í•‘í•  ì»¬ëŸ¼ëª… ë³€ê²½ì€ `@AttributeOverrides` ë¥¼ ì´ìš©í•œë‹¤

<center><img src="/assets/images/posts/books/1/4_3_ë§¤í•‘êµ¬í˜„.png" alt="ë§¤í•‘êµ¬í˜„" width="70%" height="70%"></center>

```java
@Embeddable
@Embeddable
public class ShippingInfo {
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name = "zipCode", column = @Column(name = "shipping_zip_code")),
            @AttributeOverride(name = "address1", column = @Column(name = "shipping_addr1")),
            @AttributeOverride(name = "address2", column = @Column(name = "shipping_addr2"))
    })
    private Address address;
    @Column(name = "shipping_message")
    private String message;
    @Embedded
    private Receiver receiver;
```
```java
@Entity
@Table(name = "purchase_order")
@Access(AccessType.FIELD)
public class Order {
    ...
    @Embedded
    private Orderer orderer;

    @Embedded
    private ShippingInfo shippingInfo;
    ...
```


### 4.3.2 ê¸°ë³¸ ìƒì„±ì
```java
protected Receiver(){}
```

### 4.3.2 í•„ë“œ ì ‘ê·¼ ë°©ì‹ ì‚¬ìš©
`@Access`ë¥¼ ì´ìš©í•´ì„œ ëª…ì‹œì ìœ¼ë¡œ ì ‘ê·¼ ë°©ì‹ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ `@Id`ë‚˜ `@EmbeddedId`ì˜ ìœ„ì¹˜ì— ë”°ë¼ ì ‘ê·¼ ë°©ì‹ì„ ê²°ì •í•œë‹¤.
```java
@Entity
@Table(name = "purchase_order")
@Access(AccessType.FIELD)
public class Order {
    ...ìƒëµ...
}
```

### 4.3.4 AttributeConverterë¥¼ ì´ìš©í•œ ë°¸ë¥˜ ë§¤í•‘ ì²˜ë¦¬
ë‘ ê°œ ì´ìƒì˜ í”„ë¡œí¼í‹°ë¥¼ ê°€ì§„ ë°¸ë¥˜ íƒ€ì…ì„ í•œ ê°œ ì»¬ëŸ¼ì— ë§¤í•‘í•˜ë ¤ë©´ `@Embeddable` ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œëŠ” ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤. ì´ëŸ´ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ `AttributeConverter`ì´ë‹¤.

<center><img src="/assets/images/posts/books/1/4_3_ë‘ê°œí”„ëŸ¬í¼ì»¬ëŸ¼ë§¤í•‘.png" alt="ë‘ê°œí”„ëŸ¬í¼ì»¬ëŸ¼ë§¤í•‘" width="70%" height="70%"></center>

```java
@Converter(autoApply = true)
public class MoneyConverter implements AttributeConverter<Money, Integer> { 
    // MoneyëŠ” ë°¸ë¥˜ íƒ€ì…, IntegerëŠ” DB íƒ€ì…

    // ë°¸ë¥˜ íƒ€ì…ì„ DB ì¹¼ëŸ¼ ê°’ìœ¼ë¡œ ë³€í™˜
    @Override
    public Integer convertToDatabaseColumn(Money money) {
        return money == null ? null : money.getValue();
    }

    // DB ì¹¼ëŸ¼ ê°’ì„ ë°¸ë¥˜ë¡œ ë³€í™˜
    @Override
    public Money convertToEntityAttribute(Integer value) {
        return value == null ? null : new Money(value);
    }
}
```
```java
// @Converter(autoApply = true) ì‘ì„±í•œ íƒ€ì…ì— ëŒ€í•´ ìë™ ì ìš©
public class Order {

    @Column(name = "total_amounts")
    private Money totalAmounts;
}
```
```java
// @Converter(autoApply = false) ê¸°ë³¸ê°’, ì§ì ‘ ì§€ì •í•´ì•¼í•¨
public class Order {

    @Convert(converter = MoneyConverter.class)
    @Column(name = "total_amounts")
    private Money totalAmounts;
}
```

### 4.3.5 ë°¸ë¥˜ ì»¬ë ‰ì…˜: ë³„ë„ í…Œì´ë¸” ë§¤í•‘
ë°¸ë¥˜ ì»¬ë ‰ì…˜ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ë§¤í•‘í• ë•ŒëŠ” `@ElementCollection`ê³¼ `@CollectionTable`ì„ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.

<center><img src="/assets/images/posts/books/1/4_3_ë°¸ë¥˜ì»¬ë ‰ì…˜í…Œì´ë¸”ë§¤í•‘.png" alt="ë°¸ë¥˜ì»¬ë ‰ì…˜í…Œì´ë¸”ë§¤í•‘" width="70%" height="70%"></center>

```java
@Entity
@Table(name = "purchase_order")
public class Order {
    @EmbeddedId
    private OrderNo number;

    @ElementCollection(fetch = FetchType.LAZY)
    @CollectionTable(name = "order_line", joinColumns = @JoinColumn(name = "order_number"))
    @OrderColumn(name = "line_idx")
    private List<OrderLine> orderLines;
    ...ìƒëµ...
}
```
```java
@Embeddable
public class OrderLine {
    @Embedded
    private ProductId productId;

    @Column(name = "price")
    private Money price;

    @Column(name = "quantity")
    private int quantity;

    @Column(name = "amounts")
    private Money amounts;
}
```

### 4.3.6 ë°¸ë¥˜ ì»¬ë ‰ì…˜: í•œ ê°œ ì»¬ëŸ¼ ë§¤í•‘
í•œ ê°œ ì»¬ëŸ¼ì— ì½¤ë§ˆë¡œ êµ¬ë¶„í•´ì„œ ì €ì¥í•  ë•Œ ì‚¬ìš©. `AttributeConverter`ë¥¼ ì´ìš©í•œë‹¤.

```java
public class EmailSet {
    private Set<Email> emails = new HashSet<>();

    public EmailSet(Set<Email> emails) {
        this.emails.addAll(emails);
    }

    public Set<Email> getEmails() {
        return Collections.unmodifiableSet(emails);
    }
}
```
```java
public class EmailSetConverter implements AttributeConverter<EmailSet, String> {
    @Override
    public String convertToDatabaseColumn(EmailSet attribute) {
        if (attribute == null) return null;
        return attribute.getEmails().stream()
                .map(email -> email.getAddress())
                .collect(Collectors.joining(","));
    }

    @Override
    public EmailSet convertToEntityAttribute(String dbData) {
        if (dbData == null) return null;
        String[] emails = dbData.split(",");
        Set<Email> emailSet = Arrays.stream(emails)
                .map(value -> new Email(value))
                .collect(toSet());
        return new EmailSet(emailSet);
    }
}
```

### 4.3.7 ë°¸ë¥˜ë¥¼ ì´ìš©í•œ ID ë§¤í•‘
JPAì—ì„œ ì‹ë³„ì íƒ€ì…ì€ `Serializable` íƒ€ì…ì´ì–´ì•¼ í•˜ë¯€ë¡œ `Serializable` ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ì•¼ í•œë‹¤. ë°¸ë¥˜ íƒ€ì…ìœ¼ë¡œ ì‹ë³„ìë¥¼ êµ¬í˜„í•  ë•Œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¥ì ì€ ì‹ë³„ìì— ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

```java
@Entity
@Table(name = "purchase_order")
public class Order {
    @EmbeddedId
    private OrderNo number;
    ...ìƒëµ...
}
```
```java
@Embeddable
public class OrderNo implements Serializable {
    @Column(name = "order_number")
    private String number;
    ...ìƒëµ...
}
```

### 4.3.8 ë³„ë„ í…Œì´ë¸”ì— ì €ì¥í•˜ëŠ” ë°¸ë¥˜ ë§¤í•‘
ë£¨íŠ¸ ì—”í‹°í‹° ì™¸ì— ë˜ ë‹¤ë¥¸ ì—”í‹°í‹°ê°€ ìˆë‹¤ë©´ ì§„ì§œ ì—”í‹°í‹°ì¸ì§€ ì˜ì‹¬í•´ ë´ì•¼í•œë‹¤. ë‹¨ì§€ ë³„ë„ í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì €ì¥ í•œë‹¤ê³  í•´ì„œ ì—”í‹°í‹°ì¸ ê²ƒì€ ì•„ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ `ARTICLE` í…Œì´ë¸”ê³¼ `ARTICLE_CONTENT` í…Œì´ë¸”ë¡œ ë‚˜ëˆ ì„œ ì €ì¥í•œë‹¤ê³  í•˜ì.

**ì—”í‹°í‹°ë¡œ ë§¤í•‘ ì˜ˆ (ì˜ëª» ë¨)**
<center><img src="/assets/images/posts/books/1/4_3_ë°¸ë¥˜ë§¤í•‘ì˜ëª».png" alt="ë°¸ë¥˜ë§¤í•‘ì˜ëª»" width="70%" height="70%"></center>

<br/>

**ë³„ë„ í…Œì´ë¸”ë¡œ ë§¤í•‘**  
<center><img src="/assets/images/posts/books/1/4_3_ë°¸ë¥˜ë§¤í•‘ë³„ë„í…Œì´ë¸”.png" alt="ë°¸ë¥˜ë§¤í•‘ë³„ë„í…Œì´ë¸”" width="70%" height="70%"></center>

ë°¸ë¥˜ ë§¤í•‘ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ì €ì¥ í•˜ë ¤ë©´ `@SecondaryTable`ê³¼ `@AttributeOverride`ì„ ì‚¬ìš©í•œë‹¤.
```java
@Entity
@Table(name = "article")
@SecondaryTable(
        name = "article_content",
        pkJoinColumns = @PrimaryKeyJoinColumn(name = "id")
)
public class Article {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;

    @AttributeOverrides({
            @AttributeOverride(
                    name = "content",
                    column = @Column(table = "article_content", name = "content")),
            @AttributeOverride(
                    name = "contentType",
                    column = @Column(table = "article_content", name = "content_type"))
    })
    @Embedded
    private ArticleContent content;
}
```

### 4.3.9 ë°¸ë¥˜ ì»¬ë ‰ì…˜ì„ @Entityë¡œ ë§¤í•‘í•˜ê¸°
`@OneToMany` ì‚¬ìš©
```java
@Entity
@Table(name = "product")
public class Product {
    ...ìƒëµ...
    @OneToMany(cascade = {CascadeType.PERSIST, CascadeType.REMOVE},
            orphanRemoval = true, fetch = FetchType.LAZY)
    @JoinColumn(name = "product_id")
    @OrderColumn(name = "list_idx")
    private List<Image> images = new ArrayList<>();
    ...ìƒëµ...
```

<br/>

`@Inheritance`ë¥¼ ì´ìš©í•œ ìƒì† ê°€ëŠ¥
```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "image_type")
@Table(name = "image")
public abstract class Image {
    ...ìƒëµ...
}
```
```java
@Entity
@DiscriminatorValue("II")
public class InternalImage extends Image {
    ...ìƒëµ...
}
@Entity
@DiscriminatorValue("EI")
public class ExternalImage extends Image {
    ...ìƒëµ...
```


### 4.3.10 ID ì°¸ì¡°ì™€ ì¡°ì¸ í…Œì´ë¸”ì„ ì´ìš©í•œ ë‹¨ë°©í–¥ M-N ë§¤í•‘
```java
@Entity
@Table(name = "product")
public class Product {
    ...ìƒëµ...
    @ElementCollection(fetch = FetchType.LAZY)
    @CollectionTable(name = "product_category",
            joinColumns = @JoinColumn(name = "product_id"))
    private Set<CategoryId> categoryIds;
    ...ìƒëµ...
}
```


## 4.4 ì• ê·¸ë¦¬ê±°íŠ¸ ë¡œë”© ì „ëµ
```java
// @Embeddable ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì¦‰ì‹œ ë¡œë”© ì„¤ì •
@ElementCollection(fetch = FetchType.EAGER)

// @Entity ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì§€ì—° ë¡œë”© ì„¤ì •
@OneToMany(fetch = FetchType.LAZY)
```
- ì¦‰ì‹œ ë¡œë”©: ì—ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ë¥¼ êµ¬í•  ë•Œ ì—°ê´€ëœ êµ¬ì„± ìš”ì†Œë¥¼ DBì—ì„œ í•¨ê»˜ ì½ì–´ì˜¨ë‹¤.
- ì§€ì—° ë¡œë”©: ì‹¤ì œ ì»¬ë ‰ì…˜ì— ì ‘ê·¼í•  ë•Œ DBì—ì„œ ì¡°íšŒí•œë‹¤.

## 4.5 ì• ê·¸ë¦¬ê±°íŠ¸ ì˜ì†ì„± ì „íŒŒ
ì• ê·¸ë¦¬ê±°íŠ¸ê°€ ì™„ì „í•œ ìƒíƒœì—¬ì•¼ í•œë‹¤ëŠ” ê²ƒì€ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ë¥¼ ì¡°íšŒí•  ë•Œë¿ë§Œ ì•„ë‹ˆë¼ ì €ì¥í•˜ê³  ì‚­ì œí•  ë•Œë„ í•˜ë‚˜ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨ì„ ì˜ë¯¸í•œë‹¤.
- ì €ì¥ ë©”ì„œë“œëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ë§Œ ì €ì¥í•˜ë©´ ì•ˆë˜ê³  ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ëª¨ë“  ê°ì²´ë¥¼ ì €ì¥í•´ì•¼ í•œë‹¤.
- ì‚­ì œ ë©”ì„œë“œëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ë¿Œë§Œ ì•„ë‹ˆë¼ ì• ê·¸ë¦¬ê±°íŠ¸ì— ì†í•œ ëª¨ë“  ê°ì²´ë¥¼ ì‚­ì œí•´ì•¼ í•œë‹¤.
- `@Embeddable` ë§¤í•‘ íƒ€ì…ì€ í•¨ê»˜ ì €ì¥ë˜ê³  ì‚­ì œ ë˜ë¯€ë¡œ ì¶”ê°€ ì„¤ì •ì´ í•„ìš”ì—†ë‹¤.
- `@Entity` íƒ€ì…ì— ëŒ€í•œ ë§¤í•‘ì€ `cascade` ì†ì„±ì„ ì‚¬ìš©í•œë‹¤.

```java
@OneToMany(cascade = {CascadeType.PERSIST, CascadeType.REMOVE})
```

## 4.6 ì‹ë³„ì ìƒì„± ê¸°ëŠ¥
ì‹ë³„ìëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ìƒì„±í•œë‹¤.
- ì‚¬ìš©ìê°€ ì§ì ‘ ìƒì„±
- ë„ë©”ì¸ ë¡œì§ìœ¼ë¡œ ìƒì„±
- DBë¥¼ ì´ìš©í•œ ì¼ë ¨ë²ˆí˜¸ ì‚¬ìš©

## 4.7 ë„ë©”ì¸ êµ¬í˜„ê³¼ DIP
JPAì˜ @Entityë‚˜ @Table, extends Repository ì¸í„°í˜ì´ìŠ¤ëŠ” DIP ì›ì¹™ì„ ì–´ê¸°ê³  ìˆì§€ë§Œ ê°œë°œ í¸ì˜ì„±ê³¼ ì‹¤ìš©ì„±ì„ ê°€ì§€ê³ , ë³µì¡ë„ë¥¼ ë†’ì´ì§€ ì•Šìœ¼ë©´ì„œ ê¸°ìˆ ì— ë”°ë¥¸ êµ¬í˜„ ì œì•½ì´ ë‚®ë‹¤ë©´ í•©ë¦¬ì ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.



# 5. ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì´ìš©í•œ ì¡°íšŒ ê¸°ëŠ¥

## 5.1 ì‹œì‘ì— ì•ì„œ
## 5.2 ê²€ìƒ‰ì„ ìœ„í•œ ìŠ¤í™
ì¡°íšŒë¥¼ ìœ„í•´ ë‹¤ì–‘í•œ ê²€ìƒ‰ ì¡°ê±´ì„ ì¡°í•©í•´ì•¼ í•  ë•Œê°€ ìˆë‹¤. ì´ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ìŠ¤í™([Specification](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications){:target="_blank"})ì´ë‹¤.

## 5.3 ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì´ìš©í•œ ìŠ¤í™ êµ¬í˜„

**ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” Specification ì¸í„°í˜ì´ìŠ¤**
```java
public interface Specification<T> {
  Predicate toPredicate(Root<T> root, CriteriaQuery<?> query, CriteriaBuilder builder);
}
```

<br/>

**ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ìƒì†**
```java
public interface CustomerRepository extends CrudRepository<Customer, Long>, JpaSpecificationExecutor<Customer> {
    List<Customer> findAll(Specification<Customer> spec);
    List<Customer> findAll(Specification<Customer> spec, Sort sort);
    List<Customer> findAll(Specification<Customer> spec, Pageable pageable);
}
```

<br/>

**ìŠ¤í™ ìƒì„± ê¸°ëŠ¥ì„ ë³„ë„ í´ë˜ìŠ¤ë¡œ êµ¬í˜„**
```java
public class CustomerSpecs {

  public static Specification<Customer> isLongTermCustomer() {
    return (root, query, builder) -> {
      LocalDate date = LocalDate.now().minusYears(2);
      return builder.lessThan(root.get(Customer_.createdAt), date);
    };
  }

  public static Specification<Customer> hasSalesOfMoreThan(MonetaryAmount value) {
    return (root, query, builder) -> {
      // build query here
    };
  }
}
```

<br/>

## 5.4 ë¦¬í¬ì§€í„°ë¦¬/DAOì—ì„œ ìŠ¤í™ ì‚¬ìš©í•˜ê¸°
```java
List<Customer> customers = customerRepository.findAll(isLongTermCustomer());
```

## 5.5 ìŠ¤í™ ì¡°í•©
ìŠ¤í™ ì¸í„°í˜ì´ìŠ¤ëŠ” `and`ì™€ `or` ë“± ì¡°í•© ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.
```java
MonetaryAmount amount = new MonetaryAmount(200.0, Currencies.DOLLAR);
List<Customer> customers = customerRepository.findAll(
  isLongTermCustomer().or(hasSalesOfMoreThan(amount)));
```

<br/>

`null` ê°€ëŠ¥ì„±ì´ ìˆëŠ” ìŠ¤í™ ê°ì²´ì˜ ì¡°í•©ì€ `where`ë¥¼ ì‚¬ìš©í•œë‹¤.
```java
Specification<Customer> spec = Specification.where(createNullableSpec()).and(createOtherSpec());
```


## 5.6 ì •ë ¬ ì§€ì •í•˜ê¸°
ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ë‘ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•´ì„œ ì •ë ¬ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
- ë©”ì„œë“œ ì´ë¦„ì— OrderByë¥¼ ì‚¬ìš©í•´ì„œ ì •ë ¬ ê¸°ì¤€ ì§€ì •
- Sortë¥¼ ì¸ìë¡œ ì „ë‹¬

```java
public interface OrderSummaryDao extends Repository<OrderSummary, String> {
    // OrderBy
    List<OrderSummary> findByOrdererIdOrderByNumberDesc(String ordererId);

    // Sort
    List<OrderSummary> findByOrdererId(String ordererId, Sort sort);
}
```

```java
Sort sort = Sort.by(Sort.Direction.DESC, "number");
List<OrderSummary> results = orderSummaryDao.findByOrdererId("id", sort);
```

## 5.7 í˜ì´ì§• ì²˜ë¦¬í•˜ê¸°
ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•´ `Pageable` íƒ€ì…ì„ ì´ìš©í•œë‹¤.

```java
public interface MemberDataDao extends Repository<MemberData, String> {
    List<MemberData> findByNameLike(String name, Pageable pageable);
    Page<MemberData> findByBlocked(boolean blocked, Pageable pageable);
}
```
```java
// 1ì€ í˜ì´ì§€ ë²ˆí˜¸, 0ë¶€í„° ì‹œì‘í•œë‹¤.  10ì€ ê°œìˆ˜
// Sort ì‚¬ìš© ê°€ëŠ¥
Sort sort = Sort.by(Sort.Direction.DESC, "name");
PageRequest pageReq = PageRequest.of(1, 10, sort);
List<MemberData> user = memberDataDao.findByNameLike("ì´ë¦„%", pageReq);
```

<br/>

Page ë¦¬í„´ íƒ€ì…
```java
PageRequest pageReq = PageRequest.of(1, 5);
Page<MemberData> page = memberDataDao.findByBlocked(false, pageReq);
List<MemberData> content = page.getContent(); // ì¡°íšŒ ê²°ê³¼ ëª©ë¡
long totalElements = page.getTotalElements(); // ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì „ì²´ ê°œìˆ˜
int totalPages = page.getTotalPages(); // ì „ì²´ í˜ì´ì§€ ë²ˆí˜¸
int number = page.getNumber(); // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
int numberOfElements = page.getNumberOfElements() // ì¡°íšŒ ê²°ê³¼ ê°œìˆ˜
int size = page.getSize(); // í˜ì´ì§€ í¬ê¸°
```

Page ë¦¬í„´ íƒ€ì…ì€ COUNT ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ Listë§Œ í•„ìš”í•œ ê²½ìš° ë¦¬í„´ íƒ€ì…ì„ Listë¡œ í•œë‹¤.

## 5.8 ìŠ¤í™ ì¡°í•©ì„ ìœ„í•œ ìŠ¤í™ ë¹Œë” í´ë˜ìŠ¤
ìŠ¤í™ì„ ì¡°í•©í•  ë•Œ ìŠ¤í™ ë¹Œë”ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
Specification<MemberData> spec = SpecBuilder.builder(MemberData.class)
                .ifTrue(searchRequest.isOnlyNotBlocked(), () -> MemberDataSpecs.nonBlocked())
                .ifHasText(searchRequest.getName(), name -> MemberDataSpecs.nameLike(searchRequest.getName()))
                .toSpec();
List<MemberData> result = memberDataDao.findAll(spec, PageRequest.of(0, 5));
```

```java
public class SpecBuilder {
    public static <T> Builder<T> builder(Class<T> type) {
        return new Builder<T>();
    }

    public static class Builder<T> {
        private List<Specification<T>> specs = new ArrayList<>();

        public Builder<T> and(Specification<T> spec) {
            specs.add(spec);
            return this;
        }

        public Builder<T> ifHasText(String str,
                                    Function<String, Specification<T>> specSupplier) {
            if (StringUtils.hasText(str)) {
                specs.add(specSupplier.apply(str));
            }
            return this;
        }

        public Builder<T> ifTrue(Boolean cond,
                                 Supplier<Specification<T>> specSupplier) {
            if (cond != null && cond.booleanValue()) {
                specs.add(specSupplier.get());
            }
            return this;
        }

        public Specification<T> toSpec() {
            Specification<T> spec = Specification.where(null);
            for (Specification<T> s : specs) {
                spec = spec.and(s);
            }
            return spec;
        }
    }
}
```



## 5.9 ë™ì  ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
JPQLì˜ new í‚¤ì›Œë“œë¥¼ í†µí•´ ê°ì²´ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```java
public interface OrderSummaryDao extends Repository<OrderSummary, String> {
    @Query("""    
            select new com.myshop.order.query.dto.OrderView(
                o.number, o.state, m.name, m.id, p.name
            )
            from Order o join o.orderLines ol, Member m, Product p
            where o.orderer.memberId.id = :ordererId
            and o.orderer.memberId.id = m.id
            and index(ol) = 0
            and ol.productId.id = p.id
            order by o.number.number desc
            """)
    List<OrderView> findOrderView(String ordererId);
}
```

## 5.10 í•˜ì´ë²„ë„¤ì´íŠ¸ @Subselect ì‚¬ìš©
- `@Subselect`ëŠ” ì¿¼ë¦¬ ê²°ê³¼ë¥¼ `@Entity`ë¡œ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤.
- `@Immutable`, `@Subselect`, `@Synchronize` ì™€ ê°™ì´ ì‚¬ìš©í•œë‹¤.
- ë·°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ë“¯ `@Subselect`ë¡œ ì¡°íšŒí•œ `@Entity` ì—­ì‹œ ìˆ˜ì •í•  ìˆ˜ ì—†ë‹¤.

```java
@Entity
@Immutable
@Subselect(
        """
        select o.order_number as number,
        o.version,
        o.orderer_id,
        o.orderer_name,
        o.total_amounts,
        o.receiver_name,
        o.state,
        o.order_date,
        p.product_id,
        p.name as product_name
        from purchase_order o inner join order_line ol
            on o.order_number = ol.order_number
            cross join product p
        where
        ol.line_idx = 0
        and ol.product_id = p.product_id"""
)
@Synchronize({"purchase_order", "order_line", "product"})
public class OrderSummary {
    @Id
    private String number;
    private long version;
    @Column(name = "orderer_id")
    private String ordererId;
    ...ìƒëµ...
    protected OrderSummary() {
    }
}
```





**... ì‘ì„±ì¤‘ ...**